<!doctype html>
<html lang="ko">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
  <title>사진 업로드</title>
  <style>
    /* :root { --banner-h: 72px; } /* 더 넉넉한 기본값 (ko 환경 권장) */ */

    html, body { height:100%; margin:0; background:#fafafa; }
    /* 전체를 iframe으로 덮는 고정 레이아웃 (vh 사용 안 함) */
    iframe#uploader {
      position: fixed;
      left: 0; right: 0; bottom: 0;
      width: 100%;
      height:100%;
      border: 0;
      background: #fafafa;
    }

    /* 래핑 박스는 숨김 마스크 역할만 */
    .frame-wrap { position:fixed; inset:0; overflow:hidden; }

    /* 권한 관련 워닝 감소용: 필요 권한을 명시 */
  </style>
</head>
<body>
  <div class="frame-wrap">
    <iframe id="uploader"
      allow="camera *; microphone *; clipboard-read *; clipboard-write *; geolocation *; fullscreen *; display-capture *; autoplay *; xr-spatial-tracking *"
    ></iframe>
  </div>

  <script>
    // === 이 값만 바꾸세요 ===
    
    const EXEC_URL = "https://script.google.com/macros/s/AKfycbxHPKX0LuIvzC4O4ovD--E8wwt-6ELnga1zWK8M5mKla8rV6dswMBjcXY2zLiry3bx4/exec"; // Apps Script /exec
    const REDIRECT_URL = "https://toourguest.com/cards/jh-ke#:~:text=게스트%20스냅";
    // ========================

    // ▶ 옵션: ?bh=숫자 로 배너 높이 즉석 조정, ?showBanner=1 로 배너 숨김 해제
    const q = new URLSearchParams(location.search);
    const bh = q.get('bh');
    const showBanner = q.get('showBanner') === '1';
    // if (bh) document.documentElement.style.setProperty('--banner-h', parseInt(bh,10)+'px');
    // if (showBanner) document.documentElement.style.setProperty('--banner-h', '0px');

    // 업로더 URL 구성(redirect 전달)
    const url = new URL(EXEC_URL);
    const sp = new URLSearchParams(url.search);
    sp.set('redirect', encodeURIComponent(REDIRECT_URL));
    url.search = sp.toString();
    document.getElementById('uploader').src = url.toString();

    // 주소창 깔끔하게 유지
    const prettyA = "/jh_ke_photo_upload/";
    const prettyB = "/jh_ke_photo_upload/index.html";
    if ((location.pathname !== prettyA && location.pathname !== prettyB) || location.search) {
      history.replaceState(null, "", prettyA);
    }

    // 화면 회전/리사이즈시 강제 리렌더(일부 모바일에서 레이아웃 캐시 방지)
    addEventListener('orientationchange', () => setTimeout(() => {
      document.getElementById('uploader').style.transform = 'translateZ(0)';
    }, 200));
  </script>
</body>
</html>
